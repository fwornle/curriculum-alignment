import{g as H,A as a,C as X,a as L,b as Z,o as i,c as U,U as ee,d as b,e as W,t as te,r as G,H as O,f as v,h as ne,i as V,j,k as x,l as B,m as Y,n as z,p as $,q as oe,S as se,s as ae,u as re,v as ie}from"./index-C490UVz5.js";import{y as De,D as He,I as Le,F as be,E as We,B as Ge,x as Ve,z as je,G as xe,w as Be}from"./index-C490UVz5.js";import"./redux-FVhQweS5.js";import"./vendor-gH-7aFTg.js";import"./ui-cKPigW2o.js";const ce=e=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=[],o=new Uint8Array(e);H().getRandomValues(o);for(const s of o)n.push(t[s%t.length]);return n.join("")};function de(e){return(e.match(/.{2}/g)||[]).map(n=>String.fromCharCode(parseInt(n,16))).join("")}function le(e){return e.split("").map(t=>t.charCodeAt(0).toString(16).padStart(2,"0")).join("")}new X("AuthError");const ge={oauthSignInError:{message:a.OAUTH_ERROR,log:"Make sure Cognito Hosted UI has been configured correctly"},noConfig:{message:a.DEFAULT_MSG},missingAuthConfig:{message:a.DEFAULT_MSG},emptyUsername:{message:a.EMPTY_USERNAME},invalidUsername:{message:a.INVALID_USERNAME},emptyPassword:{message:a.EMPTY_PASSWORD},emptyCode:{message:a.EMPTY_CODE},signUpError:{message:a.SIGN_UP_ERROR},noMFA:{message:a.NO_MFA},invalidMFA:{message:a.INVALID_MFA},emptyChallengeResponse:{message:a.EMPTY_CHALLENGE},noUserSession:{message:a.NO_USER_SESSION},deviceConfig:{message:a.DEVICE_CONFIG},networkError:{message:a.NETWORK_ERROR},autoSignInError:{message:a.AUTOSIGNIN_ERROR},default:{message:a.DEFAULT_MSG}},f=(e,t)=>new L({message:e??"An error has occurred during the oauth process.",name:Z.OAuthSignInError,recoverySuggestion:ge.oauthSignInError.log});var R;(function(e){e.NoConfig="noConfig",e.MissingAuthConfig="missingAuthConfig",e.EmptyUsername="emptyUsername",e.InvalidUsername="invalidUsername",e.EmptyPassword="emptyPassword",e.EmptyCode="emptyCode",e.SignUpError="signUpError",e.NoMFA="noMFA",e.InvalidMFA="invalidMFA",e.EmptyChallengeResponse="emptyChallengeResponse",e.NoUserSession="noUserSession",e.Default="default",e.DeviceConfig="deviceConfig",e.NetworkError="networkError",e.AutoSignInError="autoSignInError",e.OAuthSignInError="oauthSignInError"})(R||(R={}));const ue="`signInWithRedirect` has been canceled.",he="An error occurred while validating the state.",pe="Try to initiate an OAuth flow from Amplify",K=async e=>{const t=await i.loadOAuthState(),n=e===t?t:void 0;if(!n)throw new L({name:R.OAuthSignInError,message:e===null?ue:he,recoverySuggestion:e===null?void 0:pe});return n},q=async({currentUrl:e,userAgentValue:t,clientId:n,redirectUri:o,responseType:s,domain:r,preferPrivateSession:c})=>{const d=new U(e),u=d.searchParams.get("error"),g=d.searchParams.get("error_description");if(u)throw f(g??u);return s==="code"?me({currentUrl:e,userAgentValue:t,clientId:n,redirectUri:o,domain:r,preferPrivateSession:c}):fe({currentUrl:e,redirectUri:o,preferPrivateSession:c})},me=async({currentUrl:e,userAgentValue:t,clientId:n,redirectUri:o,domain:s,preferPrivateSession:r})=>{const c=new U(e),d=c.searchParams.get("code"),u=c.searchParams.get("state");if(!d||!u)throw f("User cancelled OAuth flow.");const g=await K(u),w="https://"+s+"/oauth2/token",m=await i.loadPKCE(),A={grant_type:"authorization_code",code:d,client_id:n,redirect_uri:o,...m?{code_verifier:m}:{}},h=Object.entries(A).map(([l,y])=>`${encodeURIComponent(l)}=${encodeURIComponent(y)}`).join("&"),{access_token:p,refresh_token:S,id_token:_,error:C,error_message:E,token_type:F,expires_in:M}=await(await fetch(w,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",[ee]:t},body:h})).json();if(C)throw f(E??C);const I=(p&&b(p).payload.username)??"username";return await W({username:I,AccessToken:p,IdToken:_,RefreshToken:S}),J({redirectUri:o,state:g,preferPrivateSession:r})},fe=async({currentUrl:e,redirectUri:t,preferPrivateSession:n})=>{const o=new U(e),{id_token:s,access_token:r,state:c,token_type:d,expires_in:u,error_description:g,error:w}=(o.hash??"#").substring(1).split("&").map(h=>h.split("=")).reduce((h,[p,S])=>({...h,[p]:S}),{id_token:void 0,access_token:void 0,state:void 0,token_type:void 0,expires_in:void 0,error_description:void 0,error:void 0});if(w)throw f(g??w);if(!r)throw f("No access token returned from OAuth flow.");const m=await K(c),A=(r&&b(r).payload.username)??"username";return await W({username:A,AccessToken:r,IdToken:s}),J({redirectUri:t,state:m,preferPrivateSession:n})},J=async({redirectUri:e,state:t,preferPrivateSession:n})=>{await te.setOAuthMetadata({oauthSignIn:!0}),await i.clearOAuthData(),await i.storeOAuthSignIn(!0,n),G(),Se(e),we(t)&&O.dispatch("auth",{event:"customOAuthState",data:de(Ae(t))},"Auth",v),O.dispatch("auth",{event:"signInWithRedirect"},"Auth",v),await ne()},we=e=>/-/.test(e),Ae=e=>e.split("-").splice(1).join("-"),Se=e=>{typeof window<"u"&&typeof window.history<"u"&&window.history.replaceState(window.history.state,"",e)},k=async e=>{G(),await i.clearOAuthInflightData(),O.dispatch("auth",{event:"signInWithRedirect_failure",data:{error:e}},"Auth",v)},Ce=async e=>{try{V(e),j(e),i.setAuthConfig(e)}catch{return}if(await i.loadOAuthInFlight())try{const t=window.location.href,{loginWith:n,userPoolClientId:o}=e,{domain:s,redirectSignIn:r,responseType:c}=n.oauth,d=x(r);await q({currentUrl:t,clientId:o,domain:s,redirectUri:d,responseType:c,userAgentValue:B(Y.SignInWithRedirect)})}catch(t){await k(t)}};z()&&$[oe](Ce);const Ie={Google:"Google",Facebook:"Facebook",Amazon:"LoginWithAmazon",Apple:"SignInWithApple"},D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",_e=e=>{const t=new Uint8Array(e);H().getRandomValues(t);let n="",o;for(const s of t)n+=D.charAt(s%D.length);return{value:n,method:"S256",toCodeChallenge(){return o||(o=Ee(n),o)}}};function Ee(e){const t=new se;return t.update(e),ye(ae.convert(t.digestSync(),{urlSafe:!0}))}function ye(e){return e.replace(/=/g,"")}const Oe=()=>ce(32),ve=e=>{async function t(n){if(n.persisted&&await e.loadOAuthInFlight()){const s=f("User cancelled OAuth flow.");await k(s)}window.removeEventListener("pageshow",t)}window.addEventListener("pageshow",t)};async function Pe(e){const t=$.getConfig().Auth?.Cognito;V(t),j(t),i.setAuthConfig(t),e?.options?.prompt||await re();let n="COGNITO";return typeof e?.provider=="string"?n=Ie[e.provider]:e?.provider?.custom&&(n=e.provider.custom),Re({oauthConfig:t.loginWith.oauth,clientId:t.userPoolClientId,provider:n,customState:e?.customState,preferPrivateSession:e?.options?.preferPrivateSession,options:{loginHint:e?.options?.loginHint,lang:e?.options?.lang,nonce:e?.options?.nonce,prompt:e?.options?.prompt},authSessionOpener:e?.options?.authSessionOpener})}const Re=async({oauthConfig:e,provider:t,clientId:n,customState:o,preferPrivateSession:s,options:r,authSessionOpener:c})=>{const{domain:d,redirectSignIn:u,responseType:g,scopes:w}=e,{loginHint:m,lang:A,nonce:h,prompt:p}=r??{},S=Oe(),_=c||ie,C=o?`${S}-${le(o)}`:S,{value:E,method:F,toCodeChallenge:M}=_e(128),I=x(e.redirectSignIn);z()&&i.storeOAuthInFlight(!0),i.storeOAuthState(C),i.storePKCE(E);const l=new URLSearchParams([["redirect_uri",I],["response_type",g],["client_id",n],["identity_provider",t],["scope",w.join(" ")]]);m&&l.append("login_hint",m),A&&l.append("lang",A),h&&l.append("nonce",h),p&&l.append("prompt",p.toLowerCase()),l.append("state",C),g==="code"&&(l.append("code_challenge",M()),l.append("code_challenge_method",F));const y=`https://${d}/oauth2/authorize?${l.toString()}`;ve(i);const{type:P,error:Q,url:N}=await _(y,u,s)??{};try{if(P==="error")throw f(String(Q));P==="success"&&N&&await q({currentUrl:N,clientId:n,domain:d,redirectUri:I,responseType:g,userAgentValue:B(Y.SignInWithRedirect),preferPrivateSession:s})}catch(T){throw await k(T),T}};export{L as AuthError,De as confirmResetPassword,He as confirmSignUp,b as decodeJWT,Le as fetchAuthSession,be as fetchUserAttributes,We as getCurrentUser,Ge as resendSignUpCode,Ve as resetPassword,je as signIn,Pe as signInWithRedirect,xe as signOut,Be as signUp};
//# sourceMappingURL=index-DvdD31NE.js.map
