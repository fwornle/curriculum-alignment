{
  "id": "snapshot_1758775623030_k2c0978t2",
  "approvalId": "approval_1758775623019_3u5nmhdrs",
  "approvalTitle": "Frontend-Backend Integration Architecture - Design Document Update",
  "version": 1,
  "timestamp": "2025-09-25T04:47:03.030Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document: Multi-Agent Curriculum Alignment System for CEU\n\n## System Overview\n\nThe Multi-Agent Curriculum Alignment System (MACAS) is a serverless, AI-driven platform that automates curriculum analysis and alignment for Central European University. The system employs eight specialized AI agents orchestrated through AWS Lambda functions, utilizing PostgreSQL for data storage, Qdrant for semantic search, and React with Tailwind CSS for the user interface.\n\n## Architecture Design\n\n### High-Level Architecture\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│                        Frontend Layer                        │\n│  ┌─────────────────────────────────────────────────────┐   │\n│  │   React + Vite + Redux + Tailwind CSS + PWA        │   │\n│  │  ┌──────────────┐  ┌──────────┐  ┌──────────────┐ │   │\n│  │  │ Top App Bar  │  │   Main   │  │ Bottom Status│ │   │\n│  │  │ (LLM Config) │  │  Content │  │     Bar      │ │   │\n│  │  └──────────────┘  └──────────┘  └──────────────┘ │   │\n│  └─────────────────────────────────────────────────────┘   │\n└─────────────────────────────────────────────────────────────┘\n                               │\n                               ▼\n┌─────────────────────────────────────────────────────────────┐\n│                         API Gateway                          │\n│         (REST API + WebSocket + Request Validation)         │\n└─────────────────────────────────────────────────────────────┘\n                               │\n                               ▼\n┌─────────────────────────────────────────────────────────────┐\n│                    Lambda Functions Layer                    │\n│  ┌─────────────────────────────────────────────────────┐   │\n│  │              Coordinator Agent (λ)                  │   │\n│  └─────────────────────────────────────────────────────┘   │\n│      │         │         │         │         │         │    │\n│      ▼         ▼         ▼         ▼         ▼         ▼    │\n│  ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐       │\n│  │Web    │ │Browser│ │Document│ │Accred.│ │  QA   │       │\n│  │Search │ │Agent  │ │Process │ │Expert │ │ Agent │       │\n│  │Agent λ│ │   λ   │ │Agent λ │ │Agent λ│ │   λ   │       │\n│  └───────┘ └───────┘ └───────┘ └───────┘ └───────┘       │\n│  ┌───────────────┐ ┌─────────────────────────────┐       │\n│  │Semantic Search│ │  Chat Interface Agent (λ)    │       │\n│  │   Agent (λ)   │ └─────────────────────────────┘       │\n│  └───────────────┘                                         │\n└─────────────────────────────────────────────────────────────┘\n                               │\n                ┌──────────────┼──────────────┐\n                ▼              ▼              ▼\n┌──────────────────┐ ┌──────────────┐ ┌──────────────┐\n│   PostgreSQL     │ │    Qdrant    │ │      S3      │\n│   (Supabase/     │ │   (Vector    │ │  (Document   │\n│     Neon)        │ │   Database)  │ │   Storage)   │\n└──────────────────┘ └──────────────┘ └──────────────┘\n```\n\n### Multi-Agent System Design\n\n#### Agent Communication Architecture\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│                    Coordinator Agent                         │\n│  ┌──────────────────────────────────────────────────────┐  │\n│  │  Workflow Orchestration Engine                       │  │\n│  │  - Task Queue Management                            │  │\n│  │  - Agent Selection Logic                            │  │\n│  │  - Error Handling & Retry                          │  │\n│  │  - Result Aggregation                              │  │\n│  └──────────────────────────────────────────────────────┘  │\n│                           │                                  │\n│    ┌──────────────────────┼──────────────────────┐         │\n│    ▼                      ▼                      ▼          │\n│ ┌─────────┐         ┌─────────┐          ┌─────────┐      │\n│ │ Message │         │ Task    │          │ Status  │      │\n│ │ Router  │         │ Scheduler│         │ Monitor │      │\n│ └─────────┘         └─────────┘          └─────────┘      │\n└─────────────────────────────────────────────────────────────┘\n```\n\n#### Agent Implementation Details\n\n| Agent | Primary Function | LLM Models | Technologies |\n|-------|-----------------|------------|--------------|\n| **Coordinator** | Workflow orchestration | N/A | Step Functions, EventBridge |\n| **Web Search** | Peer university discovery | GPT-3.5-Turbo, Grok-2 | Search APIs |\n| **Browser** | Web scraping | GPT-3.5-Turbo, Claude-Haiku | Stagehand/MCP |\n| **Document Processing** | Excel/Word/PDF handling | GPT-4-Vision, Claude-3.5 | Apache POI, PDFBox |\n| **Accreditation Expert** | Curriculum analysis | GPT-4, Claude-3.5, Grok-3 | Custom prompts |\n| **QA** | Terminology standardization | GPT-3.5-Turbo, Claude-Haiku | Rule engine |\n| **Semantic Search** | Vector similarity | Grok-1, Claude-Haiku | Qdrant |\n| **Chat Interface** | User Q&A | GPT-4, Claude-3.5, Grok-3 | LangChain |\n\n### Database Design\n\n#### PostgreSQL Schema\n\n```sql\n-- Users and Authentication\nCREATE TABLE users (\n    user_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    email VARCHAR(255) UNIQUE NOT NULL,\n    role VARCHAR(50) NOT NULL,\n    ui_preferences JSONB,\n    llm_model_preferences JSONB,\n    created_at TIMESTAMP DEFAULT NOW(),\n    updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Academic Programs\nCREATE TABLE programs (\n    program_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    ceu_program_name VARCHAR(255) NOT NULL,\n    description TEXT,\n    department VARCHAR(100),\n    created_at TIMESTAMP DEFAULT NOW(),\n    updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Courses\nCREATE TABLE courses (\n    course_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    program_id UUID REFERENCES programs(program_id),\n    course_name VARCHAR(255) NOT NULL,\n    course_code VARCHAR(50),\n    credits INTEGER,\n    learning_outcomes TEXT[],\n    content_description TEXT,\n    CONSTRAINT unique_course_code UNIQUE (program_id, course_code)\n);\n\n-- Peer Universities\nCREATE TABLE peer_universities (\n    university_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    name VARCHAR(255) NOT NULL,\n    country VARCHAR(100),\n    website_url TEXT,\n    programs_url TEXT,\n    last_analyzed_at TIMESTAMP\n);\n\n-- Peer Programs\nCREATE TABLE peer_programs (\n    peer_program_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    university_id UUID REFERENCES peer_universities(university_id),\n    program_name VARCHAR(255) NOT NULL,\n    description TEXT,\n    courses_data JSONB,\n    analysis_date TIMESTAMP DEFAULT NOW()\n);\n\n-- Gap Analyses\nCREATE TABLE gap_analyses (\n    analysis_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    program_id UUID REFERENCES programs(program_id),\n    analysis_type VARCHAR(50),\n    gaps_identified JSONB,\n    recommendations TEXT[],\n    created_by UUID REFERENCES users(user_id),\n    created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Comparison Reports\nCREATE TABLE comparison_reports (\n    report_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    ceu_program_id UUID REFERENCES programs(program_id),\n    peer_program_ids UUID[],\n    similarities JSONB,\n    differences JSONB,\n    generated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Agent Workflows\nCREATE TABLE agent_workflows (\n    workflow_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    initiating_user UUID REFERENCES users(user_id),\n    agents_involved TEXT[],\n    status VARCHAR(50),\n    start_time TIMESTAMP DEFAULT NOW(),\n    end_time TIMESTAMP,\n    results JSONB,\n    model_configurations JSONB\n);\n\n-- Chat Sessions\nCREATE TABLE chat_sessions (\n    session_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(user_id),\n    conversation_history JSONB,\n    context_data JSONB,\n    model_used VARCHAR(100),\n    created_at TIMESTAMP DEFAULT NOW(),\n    updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Documents\nCREATE TABLE documents (\n    document_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    document_type VARCHAR(50),\n    file_path TEXT,\n    processed_content TEXT,\n    extraction_metadata JSONB,\n    uploaded_by UUID REFERENCES users(user_id)\n);\n\n-- LLM Model Configurations\nCREATE TABLE llm_model_configurations (\n    config_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    user_id UUID REFERENCES users(user_id),\n    agent_type VARCHAR(50),\n    model_provider VARCHAR(50),\n    model_name VARCHAR(100),\n    api_key_reference VARCHAR(255),\n    created_at TIMESTAMP DEFAULT NOW(),\n    updated_at TIMESTAMP DEFAULT NOW(),\n    CONSTRAINT unique_user_agent_config UNIQUE (user_id, agent_type)\n);\n\n-- System Status\nCREATE TABLE system_status (\n    status_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    agent_name VARCHAR(100) NOT NULL,\n    status VARCHAR(50),\n    last_heartbeat TIMESTAMP,\n    performance_metrics JSONB,\n    error_count INTEGER DEFAULT 0,\n    created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Indexes for Performance\nCREATE INDEX idx_users_email ON users(email);\nCREATE INDEX idx_programs_department ON programs(department);\nCREATE INDEX idx_courses_program ON courses(program_id);\nCREATE INDEX idx_gap_analyses_program ON gap_analyses(program_id);\nCREATE INDEX idx_workflows_user ON agent_workflows(initiating_user);\nCREATE INDEX idx_workflows_status ON agent_workflows(status);\nCREATE INDEX idx_chat_sessions_user ON chat_sessions(user_id);\nCREATE INDEX idx_documents_type ON documents(document_type);\nCREATE INDEX idx_system_status_agent ON system_status(agent_name);\n```\n\n## API Design\n\n### RESTful API Endpoints\n\n#### Authentication & User Management\n```\nPOST   /api/auth/login\nPOST   /api/auth/logout\nPOST   /api/auth/refresh\nGET    /api/users/profile\nPUT    /api/users/profile\nGET    /api/users/preferences\nPUT    /api/users/preferences/llm-models\n```\n\n#### Program Management\n```\nGET    /api/programs\nGET    /api/programs/{id}\nPOST   /api/programs\nPUT    /api/programs/{id}\nDELETE /api/programs/{id}\nGET    /api/programs/{id}/courses\nPOST   /api/programs/{id}/courses\n```\n\n#### Data Collection\n```\nPOST   /api/collection/timeedit\nPOST   /api/collection/documents\nGET    /api/collection/status/{workflowId}\nPOST   /api/collection/peer-universities\n```\n\n#### Analysis Operations\n```\nPOST   /api/analysis/gap\nPOST   /api/analysis/comparison\nPOST   /api/analysis/semantic-search\nGET    /api/analysis/results/{analysisId}\n```\n\n#### Report Generation\n```\nPOST   /api/reports/generate\nGET    /api/reports/{reportId}\nGET    /api/reports/{reportId}/download/{format}\n```\n\n#### Chat Interface\n```\nWebSocket /ws/chat\nPOST   /api/chat/sessions\nGET    /api/chat/sessions/{sessionId}\nPOST   /api/chat/sessions/{sessionId}/messages\n```\n\n#### System Management\n```\nGET    /api/system/status\nGET    /api/system/agents\nPUT    /api/system/agents/{agentName}/config\nGET    /api/system/models/available\nGET    /api/system/models/costs\n```\n\n### API Gateway Configuration\n\n```yaml\nopenapi: 3.0.0\ninfo:\n  title: CEU Curriculum Alignment API\n  version: 1.0.0\n  \nx-amazon-apigateway-request-validators:\n  all:\n    validateRequestBody: true\n    validateRequestParameters: true\n    \nx-amazon-apigateway-gateway-responses:\n  DEFAULT_4XX:\n    responseParameters:\n      gatewayresponse.header.Access-Control-Allow-Origin: \"'*'\"\n    responseTemplates:\n      application/json: '{\"error\": \"$context.error.message\"}'\n      \npaths:\n  /api/analysis/gap:\n    post:\n      x-amazon-apigateway-integration:\n        type: aws_proxy\n        httpMethod: POST\n        uri: \n          Fn::Sub: arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${AccreditationExpertAgent.Arn}/invocations\n      requestBody:\n        required: true\n        content:\n          application/json:\n            schema:\n              type: object\n              properties:\n                programId:\n                  type: string\n                  format: uuid\n                modelPreference:\n                  type: string\n                  enum: [gpt-4, claude-3.5-sonnet, grok-3]\n              required:\n                - programId\n```\n\n## Frontend-Backend Integration Architecture\n\n### Overview\n\nThe integration layer bridges the React frontend with the AWS Lambda backend through a comprehensive service architecture that handles authentication, API communication, real-time updates, and error management.\n\n### Service Layer Architecture\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│                     Frontend Application                     │\n│  ┌────────────────────────────────────────────────────────┐ │\n│  │                    React Components                     │ │\n│  └────────────────────────────────────────────────────────┘ │\n│                             ▼                                │\n│  ┌────────────────────────────────────────────────────────┐ │\n│  │                   Redux Store & Actions                 │ │\n│  └────────────────────────────────────────────────────────┘ │\n│                             ▼                                │\n│  ┌────────────────────────────────────────────────────────┐ │\n│  │                  Service Layer (NEW)                    │ │\n│  │  ┌──────────────────────────────────────────────────┐  │ │\n│  │  │               API Client Core                     │  │ │\n│  │  │  • HTTP client with interceptors                  │  │ │\n│  │  │  • Token management & refresh                     │  │ │\n│  │  │  • Request/response transformation                │  │ │\n│  │  │  • Retry logic & circuit breaker                  │  │ │\n│  │  └──────────────────────────────────────────────────┘  │ │\n│  │                                                          │ │\n│  │  ┌──────────────────────────────────────────────────┐  │ │\n│  │  │              Domain Services                      │  │ │\n│  │  │  ┌────────────┐  ┌────────────┐  ┌────────────┐ │  │ │\n│  │  │  │  Program    │  │  Analysis  │  │   Report   │ │  │ │\n│  │  │  │  Service    │  │  Service   │  │  Service   │ │  │ │\n│  │  │  └────────────┘  └────────────┘  └────────────┘ │  │ │\n│  │  │  ┌────────────┐  ┌────────────┐  ┌────────────┐ │  │ │\n│  │  │  │  Document   │  │    Auth    │  │  LLMConfig │ │  │ │\n│  │  │  │  Service    │  │  Service   │  │  Service   │ │  │ │\n│  │  │  └────────────┘  └────────────┘  └────────────┘ │  │ │\n│  │  └──────────────────────────────────────────────────┘  │ │\n│  │                                                          │ │\n│  │  ┌──────────────────────────────────────────────────┐  │ │\n│  │  │            Real-time Services                     │  │ │\n│  │  │  ┌────────────┐  ┌────────────┐                  │  │ │\n│  │  │  │ WebSocket   │  │   Server   │                  │  │ │\n│  │  │  │  Service    │  │   Events   │                  │  │ │\n│  │  │  └────────────┘  └────────────┘                  │  │ │\n│  │  └──────────────────────────────────────────────────┘  │ │\n│  └────────────────────────────────────────────────────────┐ │\n└─────────────────────────────────────────────────────────────┘\n                               ▼\n                    ┌──────────────────┐\n                    │   API Gateway    │\n                    └──────────────────┘\n```\n\n### API Client Implementation\n\n#### Core Features\n\n1. **Request Management**\n   - Centralized HTTP client using Fetch API\n   - Request/response interceptors for common operations\n   - Request queuing and deduplication\n   - Automatic request retries with exponential backoff\n\n2. **Authentication Integration**\n   - Automatic token attachment to requests\n   - Token refresh on 401 responses\n   - Secure token storage (memory + secure storage)\n   - Session management and persistence\n\n3. **Error Handling**\n   - Standardized error response format\n   - Global error handler with toast notifications\n   - Retry strategies for transient failures\n   - Circuit breaker for failing endpoints\n\n4. **Performance Optimization**\n   - Response caching with TTL\n   - Request batching for bulk operations\n   - Lazy loading and pagination support\n   - Bandwidth-aware request strategies\n\n#### Implementation Example\n\n```typescript\n// Base API Client\nclass APIClient {\n  private baseURL: string;\n  private authTokens: AuthTokens | null = null;\n  private requestQueue: Map<string, Promise<any>> = new Map();\n  \n  constructor(config: APIClientConfig) {\n    this.baseURL = config.baseURL;\n    this.setupInterceptors();\n    this.loadAuthTokens();\n  }\n  \n  async request<T>(options: RequestOptions): Promise<APIResponse<T>> {\n    // Check for duplicate requests\n    const requestKey = this.generateRequestKey(options);\n    if (this.requestQueue.has(requestKey)) {\n      return this.requestQueue.get(requestKey);\n    }\n    \n    // Add auth headers\n    const headers = await this.getAuthHeaders();\n    \n    // Execute request with retry logic\n    const promise = this.executeWithRetry({\n      ...options,\n      headers: { ...options.headers, ...headers }\n    });\n    \n    this.requestQueue.set(requestKey, promise);\n    \n    try {\n      const response = await promise;\n      return this.transformResponse(response);\n    } finally {\n      this.requestQueue.delete(requestKey);\n    }\n  }\n  \n  private async executeWithRetry(\n    options: RequestOptions,\n    retries = 3\n  ): Promise<Response> {\n    try {\n      const response = await fetch(options.url, options);\n      \n      if (response.status === 401) {\n        await this.refreshTokens();\n        return this.executeWithRetry(options, retries);\n      }\n      \n      if (!response.ok && retries > 0) {\n        await this.delay(Math.pow(2, 3 - retries) * 1000);\n        return this.executeWithRetry(options, retries - 1);\n      }\n      \n      return response;\n    } catch (error) {\n      if (retries > 0) {\n        await this.delay(Math.pow(2, 3 - retries) * 1000);\n        return this.executeWithRetry(options, retries - 1);\n      }\n      throw error;\n    }\n  }\n}\n```\n\n### Service Layer Implementation\n\n#### Domain Services\n\nEach domain service encapsulates business logic and API interactions for a specific domain:\n\n```typescript\n// Program Service Example\nclass ProgramService {\n  constructor(private apiClient: APIClient) {}\n  \n  async getPrograms(params?: ListParams): Promise<Program[]> {\n    const response = await this.apiClient.get<Program[]>(\n      '/programs',\n      params\n    );\n    return response.data;\n  }\n  \n  async createProgram(program: CreateProgramDTO): Promise<Program> {\n    const response = await this.apiClient.post<Program>(\n      '/programs',\n      program\n    );\n    \n    // Update Redux store\n    store.dispatch(addProgram(response.data));\n    \n    // Show success notification\n    toast.success('Program created successfully');\n    \n    return response.data;\n  }\n  \n  async updateProgram(\n    id: string,\n    updates: UpdateProgramDTO\n  ): Promise<Program> {\n    const response = await this.apiClient.patch<Program>(\n      `/programs/${id}`,\n      updates\n    );\n    \n    // Update Redux store\n    store.dispatch(updateProgram({ id, changes: response.data }));\n    \n    return response.data;\n  }\n  \n  async deleteProgram(id: string): Promise<void> {\n    await this.apiClient.delete(`/programs/${id}`);\n    \n    // Update Redux store\n    store.dispatch(removeProgram(id));\n    \n    // Show success notification\n    toast.success('Program deleted successfully');\n  }\n}\n```\n\n### Authentication Flow\n\n```\n┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐\n│   User   │────▶│  Login   │────▶│ Cognito  │────▶│  Lambda  │\n└──────────┘     │   Form   │     │   Auth   │     │   Auth   │\n                 └──────────┘     └──────────┘     └──────────┘\n                       │                 │                │\n                       ▼                 ▼                ▼\n                ┌──────────┐     ┌──────────┐     ┌──────────┐\n                │  Redux   │◀────│  Tokens  │◀────│ Response │\n                │  Store   │     │  Storage │     │  Tokens  │\n                └──────────┘     └──────────┘     └──────────┘\n                       │\n                       ▼\n                ┌──────────┐\n                │Protected │\n                │  Routes  │\n                └──────────┘\n```\n\n#### Authentication Service\n\n```typescript\nclass AuthService {\n  constructor(\n    private apiClient: APIClient,\n    private cognitoClient: CognitoClient\n  ) {}\n  \n  async login(credentials: LoginCredentials): Promise<User> {\n    // Authenticate with Cognito\n    const cognitoTokens = await this.cognitoClient.authenticate(\n      credentials.email,\n      credentials.password\n    );\n    \n    // Exchange for API tokens\n    const response = await this.apiClient.post<AuthResponse>(\n      '/auth/login',\n      { cognitoTokens }\n    );\n    \n    // Store tokens\n    this.apiClient.setAuthTokens(response.data.tokens);\n    \n    // Update Redux store\n    store.dispatch(setUser(response.data.user));\n    store.dispatch(setAuthenticated(true));\n    \n    return response.data.user;\n  }\n  \n  async logout(): Promise<void> {\n    try {\n      await this.apiClient.post('/auth/logout');\n    } finally {\n      // Clear local state regardless of API response\n      this.apiClient.clearAuthTokens();\n      store.dispatch(clearAuth());\n      \n      // Redirect to login\n      window.location.href = '/login';\n    }\n  }\n  \n  async refreshSession(): Promise<boolean> {\n    try {\n      const tokens = await this.apiClient.refreshTokens();\n      this.apiClient.setAuthTokens(tokens);\n      return true;\n    } catch (error) {\n      await this.logout();\n      return false;\n    }\n  }\n}\n```\n\n### WebSocket Integration\n\n#### Real-time Connection Management\n\n```typescript\nclass WebSocketService {\n  private ws: WebSocket | null = null;\n  private reconnectAttempts = 0;\n  private maxReconnectAttempts = 5;\n  private reconnectDelay = 1000;\n  private heartbeatInterval: NodeJS.Timeout | null = null;\n  private messageHandlers = new Map<string, Set<Function>>();\n  \n  async connect(): Promise<void> {\n    const tokens = apiClient.getAuthTokens();\n    if (!tokens) {\n      throw new Error('Authentication required');\n    }\n    \n    const wsUrl = `${import.meta.env.VITE_WS_URL}?token=${tokens.accessToken}`;\n    \n    this.ws = new WebSocket(wsUrl);\n    \n    this.ws.onopen = () => {\n      console.log('WebSocket connected');\n      this.reconnectAttempts = 0;\n      this.startHeartbeat();\n      \n      // Subscribe to relevant channels\n      this.subscribe('agent-status');\n      this.subscribe('workflow-updates');\n      this.subscribe('notifications');\n    };\n    \n    this.ws.onmessage = (event) => {\n      const message = JSON.parse(event.data);\n      this.handleMessage(message);\n    };\n    \n    this.ws.onerror = (error) => {\n      console.error('WebSocket error:', error);\n    };\n    \n    this.ws.onclose = () => {\n      console.log('WebSocket disconnected');\n      this.stopHeartbeat();\n      this.attemptReconnect();\n    };\n  }\n  \n  private handleMessage(message: WSMessage): void {\n    const { type, channel, data } = message;\n    \n    // Update Redux store based on message type\n    switch (type) {\n      case 'agent-status':\n        store.dispatch(updateAgentStatus(data));\n        break;\n        \n      case 'workflow-progress':\n        store.dispatch(updateWorkflowProgress(data));\n        break;\n        \n      case 'analysis-complete':\n        store.dispatch(setAnalysisComplete(data));\n        toast.success('Analysis completed!');\n        break;\n        \n      case 'notification':\n        store.dispatch(addNotification(data));\n        break;\n        \n      case 'chat-message':\n        store.dispatch(addChatMessage(data));\n        break;\n    }\n    \n    // Call registered handlers\n    const handlers = this.messageHandlers.get(channel) || new Set();\n    handlers.forEach(handler => handler(data));\n  }\n  \n  private attemptReconnect(): void {\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      console.error('Max reconnection attempts reached');\n      store.dispatch(setWebSocketStatus('disconnected'));\n      return;\n    }\n    \n    this.reconnectAttempts++;\n    const delay = this.reconnectDelay * Math.pow(2, this.reconnectAttempts - 1);\n    \n    setTimeout(() => {\n      console.log(`Attempting reconnection ${this.reconnectAttempts}`);\n      this.connect();\n    }, delay);\n  }\n  \n  subscribe(channel: string, handler?: Function): void {\n    if (!this.messageHandlers.has(channel)) {\n      this.messageHandlers.set(channel, new Set());\n    }\n    \n    if (handler) {\n      this.messageHandlers.get(channel)!.add(handler);\n    }\n    \n    // Send subscription message to server\n    this.send({\n      type: 'subscribe',\n      channel\n    });\n  }\n  \n  send(message: any): void {\n    if (this.ws?.readyState === WebSocket.OPEN) {\n      this.ws.send(JSON.stringify(message));\n    } else {\n      console.warn('WebSocket not connected, queuing message');\n      // Queue message for sending when reconnected\n    }\n  }\n}\n```\n\n### Error Handling Strategy\n\n#### Global Error Handler\n\n```typescript\nclass ErrorHandler {\n  private errorQueue: Error[] = [];\n  private maxQueueSize = 10;\n  \n  handle(error: Error, context?: ErrorContext): void {\n    // Log error\n    console.error('Application error:', error, context);\n    \n    // Add to error queue\n    this.errorQueue.push(error);\n    if (this.errorQueue.length > this.maxQueueSize) {\n      this.errorQueue.shift();\n    }\n    \n    // Handle different error types\n    if (error instanceof APIClientError) {\n      this.handleAPIError(error);\n    } else if (error instanceof ValidationError) {\n      this.handleValidationError(error);\n    } else if (error instanceof NetworkError) {\n      this.handleNetworkError(error);\n    } else {\n      this.handleGenericError(error);\n    }\n    \n    // Report to monitoring service\n    this.reportError(error, context);\n  }\n  \n  private handleAPIError(error: APIClientError): void {\n    switch (error.statusCode) {\n      case 401:\n        // Unauthorized - redirect to login\n        authService.logout();\n        toast.error('Session expired, please login again');\n        break;\n        \n      case 403:\n        // Forbidden - show permission error\n        toast.error('You do not have permission to perform this action');\n        break;\n        \n      case 404:\n        // Not found\n        toast.error('Requested resource not found');\n        break;\n        \n      case 429:\n        // Rate limited\n        toast.warning('Too many requests, please slow down');\n        break;\n        \n      case 500:\n      case 502:\n      case 503:\n        // Server error\n        toast.error('Server error, please try again later');\n        break;\n        \n      default:\n        toast.error(error.message || 'An error occurred');\n    }\n  }\n  \n  private handleNetworkError(error: NetworkError): void {\n    // Check if offline\n    if (!navigator.onLine) {\n      toast.error('No internet connection');\n      store.dispatch(setOfflineMode(true));\n    } else {\n      toast.error('Network error, please check your connection');\n    }\n  }\n  \n  private async reportError(\n    error: Error,\n    context?: ErrorContext\n  ): Promise<void> {\n    try {\n      await apiClient.post('/errors/report', {\n        error: {\n          message: error.message,\n          stack: error.stack,\n          name: error.name\n        },\n        context,\n        userAgent: navigator.userAgent,\n        timestamp: new Date().toISOString()\n      });\n    } catch (reportError) {\n      console.error('Failed to report error:', reportError);\n    }\n  }\n}\n```\n\n### Redux Integration\n\n#### Async Thunks with Service Layer\n\n```typescript\n// Redux Thunk Actions\nexport const fetchPrograms = createAsyncThunk(\n  'programs/fetch',\n  async (params: ListParams, { rejectWithValue }) => {\n    try {\n      const programs = await programService.getPrograms(params);\n      return programs;\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  }\n);\n\nexport const createProgram = createAsyncThunk(\n  'programs/create',\n  async (program: CreateProgramDTO, { rejectWithValue }) => {\n    try {\n      const newProgram = await programService.createProgram(program);\n      return newProgram;\n    } catch (error) {\n      return rejectWithValue(error.message);\n    }\n  }\n);\n\nexport const startAnalysis = createAsyncThunk(\n  'analysis/start',\n  async (params: AnalysisParams, { dispatch }) => {\n    try {\n      // Start analysis\n      const workflow = await analysisService.startAnalysis(params);\n      \n      // Subscribe to workflow updates via WebSocket\n      wsService.subscribe(`workflow-${workflow.id}`, (update: any) => {\n        dispatch(updateWorkflowProgress(update));\n      });\n      \n      return workflow;\n    } catch (error) {\n      throw error;\n    }\n  }\n);\n\n// Redux Slice\nconst programSlice = createSlice({\n  name: 'programs',\n  initialState,\n  reducers: {\n    // Synchronous actions\n    setPrograms: (state, action) => {\n      state.programs = action.payload;\n    },\n    updateProgram: (state, action) => {\n      const index = state.programs.findIndex(\n        p => p.id === action.payload.id\n      );\n      if (index !== -1) {\n        state.programs[index] = action.payload;\n      }\n    }\n  },\n  extraReducers: (builder) => {\n    builder\n      // Fetch programs\n      .addCase(fetchPrograms.pending, (state) => {\n        state.loading = true;\n        state.error = null;\n      })\n      .addCase(fetchPrograms.fulfilled, (state, action) => {\n        state.loading = false;\n        state.programs = action.payload;\n      })\n      .addCase(fetchPrograms.rejected, (state, action) => {\n        state.loading = false;\n        state.error = action.payload as string;\n      })\n      \n      // Create program\n      .addCase(createProgram.fulfilled, (state, action) => {\n        state.programs.push(action.payload);\n      });\n  }\n});\n```\n\n### File Upload Integration\n\n```typescript\nclass DocumentService {\n  async uploadDocument(\n    file: File,\n    onProgress?: (progress: UploadProgress) => void\n  ): Promise<Document> {\n    // Get presigned URL from backend\n    const { uploadUrl, documentId } = await this.getUploadUrl({\n      fileName: file.name,\n      fileSize: file.size,\n      contentType: file.type\n    });\n    \n    // Upload to S3 directly\n    await this.uploadToS3(uploadUrl, file, onProgress);\n    \n    // Notify backend of completion\n    const document = await this.confirmUpload(documentId);\n    \n    // Start processing\n    await this.startProcessing(documentId);\n    \n    // Subscribe to processing updates\n    wsService.subscribe(`document-${documentId}`, (update: any) => {\n      store.dispatch(updateDocumentStatus(update));\n    });\n    \n    return document;\n  }\n  \n  private async uploadToS3(\n    url: string,\n    file: File,\n    onProgress?: (progress: UploadProgress) => void\n  ): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      \n      xhr.upload.addEventListener('progress', (e) => {\n        if (e.lengthComputable && onProgress) {\n          onProgress({\n            loaded: e.loaded,\n            total: e.total,\n            percentage: Math.round((e.loaded / e.total) * 100)\n          });\n        }\n      });\n      \n      xhr.addEventListener('load', () => {\n        if (xhr.status === 200) {\n          resolve();\n        } else {\n          reject(new Error(`Upload failed: ${xhr.status}`));\n        }\n      });\n      \n      xhr.addEventListener('error', () => {\n        reject(new Error('Upload failed'));\n      });\n      \n      xhr.open('PUT', url);\n      xhr.setRequestHeader('Content-Type', file.type);\n      xhr.send(file);\n    });\n  }\n}\n```\n\n### Performance Optimizations\n\n1. **Request Deduplication**: Prevent duplicate API calls for same data\n2. **Response Caching**: Cache GET requests with TTL\n3. **Request Batching**: Combine multiple requests when possible\n4. **Lazy Loading**: Load data only when needed\n5. **Optimistic Updates**: Update UI before server confirms\n6. **Pagination**: Load large datasets in chunks\n7. **Virtual Scrolling**: Render only visible items in long lists\n8. **Code Splitting**: Load services only when needed\n\n### Testing Strategy\n\n```typescript\n// Service Layer Tests\ndescribe('ProgramService', () => {\n  let service: ProgramService;\n  let mockClient: jest.Mocked<APIClient>;\n  \n  beforeEach(() => {\n    mockClient = createMockAPIClient();\n    service = new ProgramService(mockClient);\n  });\n  \n  describe('createProgram', () => {\n    it('should create program and update store', async () => {\n      const program = mockProgram();\n      mockClient.post.mockResolvedValue({\n        success: true,\n        data: program\n      });\n      \n      const result = await service.createProgram(program);\n      \n      expect(mockClient.post).toHaveBeenCalledWith(\n        '/programs',\n        program\n      );\n      expect(store.getState().programs.programs).toContain(program);\n      expect(result).toEqual(program);\n    });\n    \n    it('should handle errors gracefully', async () => {\n      mockClient.post.mockRejectedValue(\n        new APIClientError('Server error', 500, 'SERVER_ERROR')\n      );\n      \n      await expect(\n        service.createProgram(mockProgram())\n      ).rejects.toThrow('Server error');\n    });\n  });\n});\n```\n\n## Frontend Design\n\n### Component Architecture\n\n```\nsrc/\n├── components/\n│   ├── layout/\n│   │   ├── TopAppBar.tsx\n│   │   ├── BottomStatusBar.tsx\n│   │   └── MainLayout.tsx\n│   ├── chat/\n│   │   ├── ChatInterface.tsx\n│   │   ├── MessageBubble.tsx\n│   │   └── TypingIndicator.tsx\n│   ├── dashboard/\n│   │   ├── ProgramOverview.tsx\n│   │   ├── AgentStatus.tsx\n│   │   └── WorkflowProgress.tsx\n│   ├── configuration/\n│   │   ├── LLMModelSelector.tsx\n│   │   ├── ModelCostDisplay.tsx\n│   │   └── ConfigurationMenu.tsx\n│   └── common/\n│       ├── LoadingSpinner.tsx\n│       ├── ErrorBoundary.tsx\n│       └── Toast.tsx\n├── store/\n│   ├── slices/\n│   │   ├── authSlice.ts\n│   │   ├── programSlice.ts\n│   │   ├── analysisSlice.ts\n│   │   ├── chatSlice.ts\n│   │   └── systemSlice.ts\n│   └── store.ts\n├── services/\n│   ├── api/\n│   │   ├── authService.ts\n│   │   ├── programService.ts\n│   │   ├── analysisService.ts\n│   │   └── chatService.ts\n│   └── websocket/\n│       └── chatWebSocket.ts\n└── styles/\n    ├── globals.css\n    └── tailwind.config.js\n```\n\n### UI Component Specifications\n\n#### Top App Bar\n```tsx\ninterface TopAppBarProps {\n  user: User;\n  onModelConfigClick: () => void;\n  onUserMenuClick: () => void;\n}\n\nconst TopAppBar: React.FC<TopAppBarProps> = ({ user, onModelConfigClick, onUserMenuClick }) => {\n  return (\n    <header className=\"bg-ceu-blue text-white shadow-lg sticky top-0 z-50\">\n      <div className=\"container mx-auto px-4 py-3 flex items-center justify-between\">\n        {/* CEU Logo */}\n        <div className=\"flex items-center space-x-4\">\n          <img src=\"/ceu-logo.svg\" alt=\"CEU\" className=\"h-10 w-auto\" />\n          <nav className=\"hidden md:flex space-x-6\">\n            <NavLink to=\"/dashboard\">Dashboard</NavLink>\n            <NavLink to=\"/programs\">Programs</NavLink>\n            <NavLink to=\"/analysis\">Analysis</NavLink>\n            <NavLink to=\"/reports\">Reports</NavLink>\n          </nav>\n        </div>\n        \n        {/* Right Section */}\n        <div className=\"flex items-center space-x-4\">\n          {/* LLM Model Configuration */}\n          <button\n            onClick={onModelConfigClick}\n            className=\"flex items-center space-x-2 px-4 py-2 bg-ceu-gold text-ceu-blue rounded-md hover:bg-opacity-90 transition-colors\"\n          >\n            <ConfigIcon className=\"h-5 w-5\" />\n            <span className=\"hidden lg:inline\">Configure Models</span>\n          </button>\n          \n          {/* User Menu */}\n          <UserMenu user={user} onClick={onUserMenuClick} />\n        </div>\n      </div>\n    </header>\n  );\n};\n```\n\n#### Bottom Status Bar\n```tsx\ninterface BottomStatusBarProps {\n  activeAgents: AgentStatus[];\n  workflowProgress: number;\n  systemHealth: SystemHealth;\n}\n\nconst BottomStatusBar: React.FC<BottomStatusBarProps> = ({ \n  activeAgents, \n  workflowProgress, \n  systemHealth \n}) => {\n  return (\n    <footer className=\"fixed bottom-0 left-0 right-0 bg-gray-900 text-white border-t border-gray-700\">\n      <div className=\"container mx-auto px-4 py-2\">\n        <div className=\"flex items-center justify-between\">\n          {/* Active Agents */}\n          <div className=\"flex items-center space-x-3\">\n            <span className=\"text-sm font-medium\">Active Agents:</span>\n            <div className=\"flex space-x-2\">\n              {activeAgents.map(agent => (\n                <AgentIndicator\n                  key={agent.name}\n                  name={agent.name}\n                  status={agent.status}\n                  className={getStatusColor(agent.status)}\n                />\n              ))}\n            </div>\n          </div>\n          \n          {/* Workflow Progress */}\n          <div className=\"flex items-center space-x-3\">\n            <span className=\"text-sm\">Workflow Progress:</span>\n            <div className=\"w-32 bg-gray-700 rounded-full h-2\">\n              <div \n                className=\"bg-ceu-gold h-2 rounded-full transition-all duration-300\"\n                style={{ width: `${workflowProgress}%` }}\n              />\n            </div>\n            <span className=\"text-sm\">{workflowProgress}%</span>\n          </div>\n          \n          {/* System Health */}\n          <div className=\"flex items-center space-x-2\">\n            <SystemHealthIndicator health={systemHealth} />\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n};\n```\n\n#### LLM Model Configuration Menu\n```tsx\ninterface ModelConfig {\n  agentType: string;\n  provider: string;\n  model: string;\n  costPerToken: number;\n  performance: 'fast' | 'balanced' | 'quality';\n}\n\nconst LLMConfigurationMenu: React.FC = () => {\n  const [configs, setConfigs] = useState<ModelConfig[]>([]);\n  \n  const agents = [\n    'Chat Interface',\n    'Accreditation Expert',\n    'QA Agent',\n    'Semantic Search',\n    'Web Search',\n    'Browser Agent',\n    'Document Processing'\n  ];\n  \n  const models = {\n    'OpenAI': ['gpt-4', 'gpt-3.5-turbo'],\n    'Anthropic': ['claude-3.5-sonnet', 'claude-3-haiku'],\n    'Grok': ['grok-3', 'grok-2', 'grok-1'],\n    'Google': ['gemini-pro', 'gemini-flash'],\n    'Azure': ['azure-gpt-4', 'azure-gpt-35']\n  };\n  \n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n      <div className=\"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] overflow-y-auto\">\n        <div className=\"sticky top-0 bg-white border-b px-6 py-4\">\n          <h2 className=\"text-2xl font-bold text-gray-900\">LLM Model Configuration</h2>\n        </div>\n        \n        <div className=\"px-6 py-4 space-y-6\">\n          {agents.map(agent => (\n            <div key={agent} className=\"border rounded-lg p-4\">\n              <h3 className=\"font-semibold text-lg mb-3\">{agent}</h3>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <ModelSelector\n                  label=\"Provider\"\n                  options={Object.keys(models)}\n                  onChange={(provider) => handleProviderChange(agent, provider)}\n                />\n                <ModelSelector\n                  label=\"Model\"\n                  options={models[selectedProvider]}\n                  onChange={(model) => handleModelChange(agent, model)}\n                />\n                <CostDisplay\n                  costPerToken={getModelCost(selectedProvider, selectedModel)}\n                  estimatedMonthly={calculateMonthlyCost(agent, selectedModel)}\n                />\n              </div>\n            </div>\n          ))}\n        </div>\n        \n        <div className=\"sticky bottom-0 bg-white border-t px-6 py-4 flex justify-between\">\n          <div className=\"text-sm text-gray-600\">\n            Estimated Total Monthly Cost: <span className=\"font-bold text-lg\">${totalMonthlyCost}</span>\n          </div>\n          <div className=\"space-x-3\">\n            <button className=\"px-4 py-2 border rounded-md hover:bg-gray-50\">Cancel</button>\n            <button className=\"px-4 py-2 bg-ceu-blue text-white rounded-md hover:bg-opacity-90\">\n              Save Configuration\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n```\n\n### Responsive Design Patterns\n\n```css\n/* Tailwind Configuration */\nmodule.exports = {\n  theme: {\n    extend: {\n      colors: {\n        'ceu-blue': '#0033A0',\n        'ceu-gold': '#FFC72C',\n      },\n      screens: {\n        'xs': '475px',\n        'sm': '640px',\n        'md': '768px',\n        'lg': '1024px',\n        'xl': '1280px',\n        '2xl': '1536px',\n        'ultrawide': '1920px',\n      },\n    },\n  },\n  plugins: [\n    require('@tailwindcss/forms'),\n    require('@tailwindcss/typography'),\n  ],\n}\n\n/* Responsive Grid Layout */\n.dashboard-grid {\n  @apply grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4;\n}\n\n/* Adaptive Navigation */\n.nav-menu {\n  @apply hidden md:flex;\n}\n\n.mobile-menu {\n  @apply flex md:hidden;\n}\n\n/* Touch-Optimized Controls */\n.touch-target {\n  @apply min-h-[44px] min-w-[44px];\n}\n\n/* Orientation-Aware Layouts */\n@media (orientation: landscape) and (max-height: 500px) {\n  .landscape-compact {\n    @apply py-1 text-sm;\n  }\n}\n```\n\n## Infrastructure as Code\n\n### AWS SAM Template\n\n```yaml\nAWSTemplateFormatVersion: '2010-09-09'\nTransform: AWS::Serverless-2016-10-31\n\nParameters:\n  Environment:\n    Type: String\n    Default: dev\n    AllowedValues: [dev, prod]\n  PostgresConnectionString:\n    Type: String\n    NoEcho: true\n  QdrantApiKey:\n    Type: String\n    NoEcho: true\n\nGlobals:\n  Function:\n    Runtime: nodejs18.x\n    Timeout: 300\n    MemorySize: 1024\n    Environment:\n      Variables:\n        ENVIRONMENT: !Ref Environment\n        POSTGRES_URL: !Ref PostgresConnectionString\n        QDRANT_API_KEY: !Ref QdrantApiKey\n\nResources:\n  # API Gateway\n  CurriculumAPI:\n    Type: AWS::Serverless::Api\n    Properties:\n      StageName: !Ref Environment\n      Cors:\n        AllowMethods: \"'*'\"\n        AllowHeaders: \"'*'\"\n        AllowOrigin: \"'*'\"\n      Auth:\n        DefaultAuthorizer: CognitoAuthorizer\n        Authorizers:\n          CognitoAuthorizer:\n            UserPoolArn: !GetAtt UserPool.Arn\n\n  # Cognito User Pool\n  UserPool:\n    Type: AWS::Cognito::UserPool\n    Properties:\n      UserPoolName: !Sub ${AWS::StackName}-users\n      AutoVerifiedAttributes:\n        - email\n      Schema:\n        - Name: email\n          Required: true\n          Mutable: false\n\n  # Lambda Functions\n  CoordinatorAgent:\n    Type: AWS::Serverless::Function\n    Properties:\n      CodeUri: ./lambda/coordinator\n      Handler: index.handler\n      Events:\n        ApiEvent:\n          Type: Api\n          Properties:\n            RestApiId: !Ref CurriculumAPI\n            Path: /api/workflow/start\n            Method: POST\n\n  WebSearchAgent:\n    Type: AWS::Serverless::Function\n    Properties:\n      CodeUri: ./lambda/web-search\n      Handler: index.handler\n      Environment:\n        Variables:\n          SEARCH_API_KEY: !Ref SearchApiKey\n\n  BrowserAgent:\n    Type: AWS::Serverless::Function\n    Properties:\n      CodeUri: ./lambda/browser\n      Handler: index.handler\n      Layers:\n        - !Ref StagehandLayer\n      MemorySize: 2048\n\n  DocumentProcessingAgent:\n    Type: AWS::Serverless::Function\n    Properties:\n      CodeUri: ./lambda/document-processing\n      Handler: index.handler\n      Environment:\n        Variables:\n          S3_BUCKET: !Ref DocumentBucket\n\n  AccreditationExpertAgent:\n    Type: AWS::Serverless::Function\n    Properties:\n      CodeUri: ./lambda/accreditation-expert\n      Handler: index.handler\n      Environment:\n        Variables:\n          DEFAULT_LLM_MODEL: gpt-4\n\n  QAAgent:\n    Type: AWS::Serverless::Function\n    Properties:\n      CodeUri: ./lambda/qa-agent\n      Handler: index.handler\n      Environment:\n        Variables:\n          DEFAULT_LLM_MODEL: claude-3-haiku\n\n  SemanticSearchAgent:\n    Type: AWS::Serverless::Function\n    Properties:\n      CodeUri: ./lambda/semantic-search\n      Handler: index.handler\n      Environment:\n        Variables:\n          DEFAULT_LLM_MODEL: grok-1\n          QDRANT_URL: !Ref QdrantEndpoint\n\n  ChatInterfaceAgent:\n    Type: AWS::Serverless::Function\n    Properties:\n      CodeUri: ./lambda/chat-interface\n      Handler: index.handler\n      Environment:\n        Variables:\n          DEFAULT_LLM_MODEL: claude-3.5-sonnet\n\n  # Step Functions\n  WorkflowStateMachine:\n    Type: AWS::Serverless::StateMachine\n    Properties:\n      DefinitionUri: ./statemachine/workflow.asl.json\n      Role: !GetAtt StatesExecutionRole.Arn\n\n  # S3 Buckets\n  DocumentBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      BucketEncryption:\n        ServerSideEncryptionConfiguration:\n          - ServerSideEncryptionByDefault:\n              SSEAlgorithm: AES256\n      VersioningConfiguration:\n        Status: Enabled\n\n  StaticWebsiteBucket:\n    Type: AWS::S3::Bucket\n    Properties:\n      WebsiteConfiguration:\n        IndexDocument: index.html\n        ErrorDocument: error.html\n      PublicAccessBlockConfiguration:\n        BlockPublicAcls: false\n        BlockPublicPolicy: false\n\n  # CloudFront Distribution\n  WebDistribution:\n    Type: AWS::CloudFront::Distribution\n    Properties:\n      DistributionConfig:\n        Origins:\n          - Id: S3-Website\n            DomainName: !GetAtt StaticWebsiteBucket.WebsiteURL\n            CustomOriginConfig:\n              OriginProtocolPolicy: http-only\n        Enabled: true\n        DefaultRootObject: index.html\n        DefaultCacheBehavior:\n          TargetOriginId: S3-Website\n          ViewerProtocolPolicy: redirect-to-https\n          AllowedMethods:\n            - GET\n            - HEAD\n            - OPTIONS\n\n  # DLQ for Failed Processing\n  DeadLetterQueue:\n    Type: AWS::SQS::Queue\n    Properties:\n      MessageRetentionPeriod: 1209600  # 14 days\n      VisibilityTimeout: 300\n\nOutputs:\n  APIEndpoint:\n    Description: API Gateway endpoint URL\n    Value: !Sub https://${CurriculumAPI}.execute-api.${AWS::Region}.amazonaws.com/${Environment}\n  WebsiteURL:\n    Description: CloudFront distribution URL\n    Value: !GetAtt WebDistribution.DomainName\n```\n\n## Security Design\n\n### Authentication & Authorization Flow\n\n```\n┌──────────────┐     ┌──────────────┐     ┌──────────────┐\n│    Client    │────▶│   Cognito    │────▶│  API Gateway │\n└──────────────┘     └──────────────┘     └──────────────┘\n                            │                      │\n                            ▼                      ▼\n                     ┌──────────────┐     ┌──────────────┐\n                     │   JWT Token  │────▶│    Lambda    │\n                     └──────────────┘     └──────────────┘\n```\n\n### Security Measures\n\n1. **API Security**\n   - AWS WAF for API Gateway protection\n   - Rate limiting and throttling\n   - Request validation\n   - CORS configuration\n\n2. **Data Security**\n   - Encryption at rest (S3, PostgreSQL)\n   - Encryption in transit (TLS 1.3)\n   - AWS Secrets Manager for API keys\n   - VPC endpoints for private communication\n\n3. **Agent Security**\n   - IAM roles with least privilege\n   - Lambda function isolation\n   - Environment variable encryption\n   - DLQ for failed processing\n\n## Deployment Strategy\n\n### CI/CD Pipeline\n\n```yaml\n# GitHub Actions Workflow\nname: Deploy to AWS\n\non:\n  push:\n    branches: [main, develop]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - name: Run Tests\n        run: npm test\n\n  deploy:\n    needs: test\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      \n      - name: Configure AWS Credentials\n        uses: aws-actions/configure-aws-credentials@v1\n        with:\n          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}\n          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n          aws-region: us-east-1\n      \n      - name: Build Lambda Functions\n        run: |\n          npm ci\n          npm run build\n      \n      - name: Deploy SAM Application\n        run: |\n          sam build\n          sam deploy --no-confirm-changeset --no-fail-on-empty-changeset\n      \n      - name: Build and Deploy Frontend\n        run: |\n          cd frontend\n          npm ci\n          npm run build\n          aws s3 sync dist/ s3://${{ secrets.STATIC_BUCKET }}\n          aws cloudfront create-invalidation --distribution-id ${{ secrets.CF_DISTRIBUTION_ID }} --paths \"/*\"\n```\n\n### Environment Configuration\n\n```bash\n# .env.development\nVITE_API_ENDPOINT=http://localhost:3000\nVITE_WS_ENDPOINT=ws://localhost:3001\nPOSTGRES_URL=postgresql://user:pass@localhost:5432/curriculum_dev\nQDRANT_URL=http://localhost:6333\n\n# .env.production\nVITE_API_ENDPOINT=https://api.ceu-curriculum.edu\nVITE_WS_ENDPOINT=wss://ws.ceu-curriculum.edu\nPOSTGRES_URL=${SUPABASE_CONNECTION_STRING}\nQDRANT_URL=${QDRANT_CLOUD_URL}\n```\n\n## Performance Optimization\n\n### Caching Strategy\n1. **CloudFront CDN** - Static assets caching\n2. **API Gateway Caching** - Response caching for GET requests\n3. **Lambda Layer Caching** - Shared dependencies\n4. **PostgreSQL Query Caching** - Prepared statements\n5. **Qdrant Index Caching** - Vector similarity caching\n\n### Scalability Measures\n1. **Lambda Concurrency** - Reserved concurrency for critical functions\n2. **PostgreSQL Connection Pooling** - pgBouncer integration\n3. **S3 Transfer Acceleration** - Fast uploads\n4. **Auto-scaling Policies** - Based on CloudWatch metrics\n\n## Monitoring & Observability\n\n### CloudWatch Dashboards\n\n```json\n{\n  \"widgets\": [\n    {\n      \"type\": \"metric\",\n      \"properties\": {\n        \"metrics\": [\n          [\"AWS/Lambda\", \"Invocations\", {\"stat\": \"Sum\"}],\n          [\"AWS/Lambda\", \"Errors\", {\"stat\": \"Sum\"}],\n          [\"AWS/Lambda\", \"Duration\", {\"stat\": \"Average\"}],\n          [\"AWS/Lambda\", \"ConcurrentExecutions\", {\"stat\": \"Maximum\"}]\n        ],\n        \"period\": 300,\n        \"stat\": \"Average\",\n        \"region\": \"us-east-1\",\n        \"title\": \"Agent Performance\"\n      }\n    },\n    {\n      \"type\": \"metric\",\n      \"properties\": {\n        \"metrics\": [\n          [\"AWS/ApiGateway\", \"Count\", {\"stat\": \"Sum\"}],\n          [\"AWS/ApiGateway\", \"4XXError\", {\"stat\": \"Sum\"}],\n          [\"AWS/ApiGateway\", \"5XXError\", {\"stat\": \"Sum\"}],\n          [\"AWS/ApiGateway\", \"Latency\", {\"stat\": \"Average\"}]\n        ],\n        \"period\": 300,\n        \"stat\": \"Average\",\n        \"region\": \"us-east-1\",\n        \"title\": \"API Gateway Metrics\"\n      }\n    }\n  ]\n}\n```\n\n### Alerts Configuration\n\n```yaml\nAlarms:\n  HighErrorRate:\n    MetricName: Errors\n    Namespace: AWS/Lambda\n    Statistic: Sum\n    Period: 300\n    EvaluationPeriods: 2\n    Threshold: 10\n    ComparisonOperator: GreaterThanThreshold\n    \n  HighLatency:\n    MetricName: Duration\n    Namespace: AWS/Lambda\n    Statistic: Average\n    Period: 300\n    EvaluationPeriods: 2\n    Threshold: 5000  # 5 seconds\n    ComparisonOperator: GreaterThanThreshold\n```\n\n## Cost Optimization\n\n### Model Selection Strategy\n- **Semantic Analysis**: Grok-1 ($0.002/1K tokens)\n- **QA Tasks**: Claude-3-Haiku ($0.003/1K tokens)\n- **Complex Analysis**: GPT-4 only when necessary ($0.10/1K tokens)\n- **Default Fallback**: GPT-3.5-Turbo ($0.01/1K tokens)\n\n### Cost Monitoring\n```typescript\ninterface CostTracker {\n  trackUsage(agent: string, model: string, tokens: number): void;\n  getDailyCost(): number;\n  getMonthlyCost(): number;\n  getProjectedCost(): number;\n}\n\nclass LLMCostTracker implements CostTracker {\n  private usage: Map<string, ModelUsage> = new Map();\n  \n  trackUsage(agent: string, model: string, tokens: number): void {\n    const cost = this.calculateCost(model, tokens);\n    // Store in PostgreSQL for analysis\n  }\n  \n  getDailyCost(): number {\n    // Query PostgreSQL for daily totals\n  }\n}\n```\n\n## Testing Strategy\n\n### Unit Testing\n```typescript\n// Agent Unit Test Example\ndescribe('AccreditationExpertAgent', () => {\n  it('should identify curriculum gaps', async () => {\n    const mockProgram = createMockProgram();\n    const result = await agent.analyzeGaps(mockProgram);\n    expect(result.gaps).toHaveLength(3);\n    expect(result.recommendations).toBeDefined();\n  });\n});\n```\n\n### Integration Testing\n```typescript\n// Workflow Integration Test\ndescribe('Curriculum Analysis Workflow', () => {\n  it('should complete end-to-end analysis', async () => {\n    const workflowId = await startWorkflow({\n      programId: 'test-program',\n      analysisType: 'comprehensive'\n    });\n    \n    await waitForCompletion(workflowId);\n    const result = await getWorkflowResult(workflowId);\n    \n    expect(result.status).toBe('completed');\n    expect(result.agents).toContain('AccreditationExpertAgent');\n  });\n});\n```\n\n### Load Testing\n```yaml\n# k6 Load Test Script\nimport http from 'k6/http';\nimport { check, sleep } from 'k6';\n\nexport let options = {\n  stages: [\n    { duration: '2m', target: 100 },\n    { duration: '5m', target: 100 },\n    { duration: '2m', target: 0 },\n  ],\n};\n\nexport default function() {\n  let response = http.post('${API_ENDPOINT}/api/analysis/gap', {\n    programId: 'load-test-program'\n  });\n  \n  check(response, {\n    'status is 200': (r) => r.status === 200,\n    'response time < 2000ms': (r) => r.timings.duration < 2000,\n  });\n  \n  sleep(1);\n}\n```\n\n## Rollback Strategy\n\n### Blue-Green Deployment\n1. Deploy new version to green environment\n2. Run smoke tests\n3. Switch traffic gradually (10% → 50% → 100%)\n4. Monitor error rates\n5. Rollback if errors exceed threshold\n\n### Database Migration Rollback\n```sql\n-- Migration Scripts with Rollback\n-- UP Migration\nALTER TABLE programs ADD COLUMN new_field TEXT;\n\n-- DOWN Migration (Rollback)\nALTER TABLE programs DROP COLUMN new_field;\n```\n\n## Success Criteria\n\n### Technical Metrics\n- API response time < 1 second for 95% of requests\n- System uptime > 99.9%\n- Lambda cold start < 3 seconds\n- Cost per analysis < $0.50\n\n### Business Metrics\n- Process 100% of CEU programs within first quarter\n- Achieve 80% cost reduction vs. manual process\n- Generate reports in < 5 minutes\n- Support 50+ concurrent users\n\n## Risk Mitigation\n\n| Risk | Likelihood | Impact | Mitigation |\n|------|------------|--------|------------|\n| LLM API Rate Limits | Medium | High | Implement queueing and retry logic |\n| PostgreSQL Connection Limits | Low | High | Use connection pooling |\n| Web Scraping Blocks | Medium | Medium | Rotate user agents, implement delays |\n| Cost Overrun | Medium | Medium | Real-time cost monitoring and alerts |\n| Data Privacy Breach | Low | Critical | Encryption, access controls, audit logs |\n\n## Conclusion\n\nThis design document provides a comprehensive technical blueprint for implementing the Multi-Agent Curriculum Alignment System. The serverless architecture ensures scalability and cost-effectiveness, while the multi-agent design enables sophisticated curriculum analysis capabilities. The system's modular design allows for future enhancements and easy maintenance.",
  "fileStats": {
    "size": 61573,
    "lines": 1892,
    "lastModified": "2025-09-25T04:45:02.390Z"
  },
  "comments": []
}